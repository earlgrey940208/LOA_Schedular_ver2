events {
    worker_connections 1024;  # 동시 연결 수 제한
}

http {
    include /etc/nginx/mime.types;           # MIME 타입 설정 포함
    default_type application/octet-stream;   # 기본 MIME 타입

    server {
        listen 5173;                         # Vue 개발 포트와 동일하게 설정
        server_name 
            localhost               # 로컬 개발환경
            192.168.219.100        # 개발서버 IP
            192.168.219.102        # 뭔지 진짜 모르는 IP
            192.168.219.103        # 서버 IP
            1.213.234.164          # 서버 공인 IP 1
            112.149.7.35           # 성현 공인 IP 2
            172.30.96.1            # 회사 IP
            ;                     # 모든 호스트 허용 -> "_"가 있었음. 접근안되면 쓰기...
        root /usr/share/nginx/html;          # 빌드된 Vue 앱 위치
        index index.html;

        # Vue Router의 History 모드를 위한 설정
        # 모든 요청을 index.html로 리다이렉트 (SPA 라우팅)
        location / {
            try_files $uri $uri/ /index.html;
        }

        # API 요청을 백엔드로 프록시
        location /api/ {
            proxy_pass http://backend:19013/api/;  # 백엔드 컨테이너로 전달
            proxy_set_header Host $host;           # 원본 호스트 헤더 유지
            proxy_set_header X-Real-IP $remote_addr;  # 클라이언트 실제 IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # 바디 크기 제한 설정
            client_max_body_size 10M;
            
            # 모든 HTTP 메서드 허용
            limit_except GET POST PUT DELETE OPTIONS {
                deny all;
            }
        }

        # 정적 파일 캐싱 (성능 최적화)
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}